---
title: "Thread"
layout: post
categories: [C#]
tags: [C#]
---
# C# 쓰레드

## 쓰레드의 정의

- 프로세스 내에 실행되는 작은 단위로서 병렬처리가 가능 한 것.
- 한 개의 프로세스에는 여러 개의 스레드가 처리될 수 있다.[^1]

## Background vs Foreground

- Foreground 쓰레드는 메인 쓰레드가 종료되어도 프로세스를 계속 실행.
- Background 쓰레드는 메인 쓰레드가 종료되면 바로 프로세스를 종료.[^2]

## 쓰레드풀에서 사용 가능한 쓰레드 할당 받는 방법

1. ThreadPool 클래스
2. 비동기 델리게이트(Asynchronous delegate)
3. .NET 4 Task 클래스
4. .NET 4 Task<T> 클래스
5. BackgroundWorker 클래스

- 최대 쓰레드수 만큼 쓰레드가 생생된 후, 계속 쓰레드 생성 요청이 있으면, 해당 요청 쓰레드는 생성되지 않고 대기하게 된다.[^3]

### **ThreadPool 클래스**

- ThreadPool.QueueUserWorkItem() 를 사용하여 실행하고자 하는 메서드 델리게이트를 지정하면 시스템풀에서 쓰레드를 할당하여 실행
- 실행되는 메서드로부터 리턴 값을 돌려받을 필요가 없는 곳에 주로 사용[^4]

### **비동기 델리게이트 (Asynchronous Delegate)**

- <http://www.csharpstudy.com/Threads/async-delegate.aspx> 참고.

### **BackgroundWorker 클래스**

-  BackgroundWorker는 이벤트를 기반으로 비동기 처리를 진행하는 패턴 (Event-based Asynchronous Pattern)을 구현한 클래스
-   BackgroundWorker로부터 생성된 객체는 DoWork 이벤트 핸들러를 통해 실제 작업할 내용을 지정하고, RunWorkerAsync() 메서드를 호출하여 작업을 시작  

```C#
        // 예시
        private BackgroundWorker worker = new BackgroundWorker();
        worker.DoWork += new DoWorkEventHandler(worker_DoWork);
        worker.RunWorkerAsync();
```

### **Task 클래스**

- 쓰레드풀로부터 쓰레드를 가져와 비동기 작업을 실행한다
- Task.Factory.StartNew() -> 쓰레드를 생성과 동시에 실행하는 방식
- Task() 생성자 메서드 델리게이트 -> 시작을 하지않고 Task 객채를 만듬
    - Start() -> 실제 쓰레드를 시작
    - Wait() -> 메서드가 종료될 떄까지 대기.

### **Task<T> 클래스**
- Non-Generic 타입인 Task 클래스와 달리 리턴 값을 돌려 받을 수 있다.
- Task<T> 클래스의 T는 리턴 타입을 가리킴
- Task 객체 생성 후 Result 속성을 참고하여 리턴 값을 얻음

```C#
    // Task<T>를 이용하여 쓰레드 생성과 시작
    Task<int> task = Task.Factory.StartNew<int>(() => a + b);

    // 쓰레드 결과 리턴. 쓰레드가 계속 실행중이면
    // 이곳에서 끝날 때까지 대기함
    int result = task.Result;
```
## Parallel 클래스
- Parallel.For()와 Parallel.ForEach() 메서드를 통해 다중 CPU에서 다중 쓰레드가 병렬로 데이타를 분할하여 처리하는 기능을 제공
- Parallel.Invoke() 메서드로 여러 작업들을 병렬로 처리함
---
[^1]: 출처 <https://nowonbun.tistory.com/133>  
[^2]: 출처 <http://www.csharpstudy.com/Threads/thread2.aspx>  
[^3]: 위와 동일  
[^4]: 위와 동일  
[^5]: 위와 동일  